# DNS-прокси-сервер

DNS-прокси-сервер с фильтрацией доменов по "чёрному списку".

## Функциональность

- Перенаправление DNS-запросов на вышестоящий DNS-сервер
- Фильтрация доменов по "чёрному списку"
- Поддержка различных типов блокировки (NXDOMAIN, REFUSED, REDIRECT)
- Динамическая перезагрузка конфигурации без перезапуска сервера
- Поддержка шаблонов (wildcard) для блокировки групп доменов

## Требования

- Python 3.9+
- Зависимости из файла requirements.txt

## Установка

1. Клонировать репозиторий
2. Создать виртуальное окружение и активировать его:

```
python3 -m venv .venv
source .venv/bin/activate
```

3. Установить зависимости:

```
pip install -r requirements.txt
```

## Настройка

Настройка сервера осуществляется через файл `config.yaml`:

```yaml
# IP-адрес и порт upstream DNS-сервера
upstream:
  host: "8.8.8.8"
  port: 53

# Черный список доменов
# Поддерживаются wildcard (*) для блокировки групп доменов:
# - example.com - блокировка конкретного домена
# - *.example.com - блокировка всех поддоменов
# - *.test.* - блокировка доменов содержащих .test.
blacklist:
  - "example.com"
  - "*.badwebsite.org"
  - "malware.test"
  - "tracker.*"

# Тип ответа:
# - NXDOMAIN (домен не существует)
# - REFUSED (отказано в запросе)
# - REDIRECT (перенаправление на заданный IP)
blacklist_response_type: "REFUSED"

# IP для перенаправления (для REDIRECT)
redirect_ip: "127.0.0.1"

# Интервал перезагрузки конфигурации (секунды)
reload_interval: 10
```

## Запуск

Запуск сервера:

```
python main.py
```

По умолчанию сервер прослушивает порт UDP/5353. Для перенаправления запросов с UDP/53 на UDP/5353 требуются административные права.

## Тестирование

### Автоматические тесты

Запуск тестов:

```
pytest
```

### Ручное тестирование

Можно использовать утилиту `dig` для проверки работоспособности:

1. Проверка разрешенного домена:
```
dig @127.0.0.1 -p 5353 google.com
```

2. Проверка заблокированного домена:
```
dig @127.0.0.1 -p 5353 example.com
dig @127.0.0.1 -p 5353 sub.badwebsite.org
```

## Известные ограничения

- Обрабатываются только A-запросы (IPv4)
- Нет кэширования запросов
- Не поддерживается TCP DNS (только UDP)
- Нет аутентификации или шифрования
- Минимальная проверка корректности DNS-пакетов

## Дополнительные возможности

- Асинхронная архитектура для высокой производительности
- Автоматическая перезагрузка конфигурации без перезапуска сервера
- Подробное логирование в консоль и файл proxy.log 
- Поддержка шаблонов с wildcard (*) для блокировки групп доменов 